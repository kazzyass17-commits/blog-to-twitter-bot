# GitHub ActionsのIPアドレスブロックを確認する方法

## 確認方法

### 方法1: スクリプトで自動確認

作成した `check_ip_blocking.py` スクリプトを実行すると、以下を確認できます：

1. **現在のIPアドレス**
2. **X APIへのアクセス**
3. **実行環境（GitHub Actionsかローカルか）**

#### 実行方法

```powershell
# ローカル環境で実行
python check_ip_blocking.py

# GitHub Actionsで実行（自動的に実行されます）
```

### 方法2: 手動で確認

#### ステップ1: 現在のIPアドレスを確認

1. GitHub Actionsのログで、`check_ip_blocking.py` の出力を確認
2. 「現在のIPアドレス」が表示されます

または、以下のコマンドで確認：

```bash
curl https://api.ipify.org?format=json
```

#### ステップ2: X APIへのアクセステスト

1. Bearer Tokenを使用してX APIにアクセス
2. レスポンスを確認：
   - **200 OK**: IPブロックされていない
   - **403 Forbidden + HTML**: IPブロックされている可能性が高い
   - **403 Forbidden + JSON**: 認証エラーまたはアプリの権限の問題

### 方法3: ローカル環境でテスト

GitHub Actionsではなく、ローカル環境でテストして比較します。

#### ローカル環境でテスト

1. `.env`ファイルを作成して認証情報を設定
2. ローカルで接続テストを実行：

```powershell
python test_twitter_connection.py --account both
```

3. 結果を比較：
   - **ローカルで成功、GitHub Actionsで失敗**: IPブロックの可能性が高い
   - **両方で失敗**: 認証情報やアプリの権限の問題

## 確認結果の解釈

### IPブロックされている場合

**症状:**
- レスポンス本文にHTML（「Just a moment...」など）が返ってくる
- ステータスコード: 403 Forbidden
- エラーメッセージにセキュリティチェックの内容が含まれる

**対処法:**
1. しばらく待ってから再試行（1時間〜数時間）
2. 別の時間帯に再試行
3. X Developer Portalのサポートに問い合わせ

### IPブロックされていない場合

**症状:**
- ステータスコード: 200 OK または 401 Unauthorized
- レスポンス本文がJSON形式

**対処法:**
- 認証情報やアプリの権限を確認
- Access Tokenを再生成

## GitHub ActionsのIPアドレスの特徴

### 動的に変わる

- GitHub ActionsのIPアドレスは動的に変わります
- 実行のたびに異なるIPアドレスからアクセスする可能性があります

### 共有IPアドレス

- GitHub ActionsのIPアドレスは複数のユーザーで共有されています
- 他のユーザーのアクセスが原因でブロックされる可能性があります

### レート制限

- 複数のユーザーが同じIPアドレスを使用するため、レート制限に達しやすい

## 対処法

### 1. 時間を置いて再試行

1時間〜数時間待ってから、接続テストを再実行してください。

### 2. 別の時間帯に再試行

GitHub Actionsのワークフローを別の時間帯に実行してください。

### 3. ローカル環境でテスト

ローカル環境でテストして、IPブロックかどうか確認してください。

### 4. X Developer Portalのサポートに問い合わせ

アプリの状態や403エラーの原因について問い合わせてください。

## 確認チェックリスト

- [ ] 現在のIPアドレスを確認
- [ ] X APIへのアクセステストを実行
- [ ] レスポンス本文を確認（HTMLかJSONか）
- [ ] ローカル環境でテスト（比較用）
- [ ] GitHub Actionsのログで詳細を確認

